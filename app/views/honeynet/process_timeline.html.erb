<% content_for :data do %>
<%
	def map_to_hash(data)
	  data.map { |d| { :pid => d.pid, :observed_at => d.observed_at.to_f, :thread_index => (d.thread_index || 0), :counter => d.counter } }
	end
-%>
	<script>
		var raw_data = <%=raw (map_to_hash @data).to_json %>;
	</script>
<% end %>

<% content_for :note do %>
	<% timeline = ApplicationHelper::Timeline.new %>
	<% ApacheAccess.all.map { |d| d.pid }.compact.uniq.sort.each do |pid| %>
		<% timeline.add_event("PID: #{pid}", ApacheAccess.where("pid = ?", pid)) { |d| d.observed_at.to_f+(d.processing_time.to_f/(10**6)) } %>
	<% end %>

	<%= render :partial => '/graph/timeline', :object => timeline %>
<% end %>